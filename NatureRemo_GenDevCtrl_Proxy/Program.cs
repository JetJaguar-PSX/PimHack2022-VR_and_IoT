using LazyHttpServerLib;

string endpoint = "http://192.168.10.104/messages";

HttpClient client = new HttpClient();
HttpServer server = new(new string[]{ "http://localhost:15080/" });



server.IncomingHttpRequest += async (sender, e) =>
{
    var request = new HttpRequestMessage(HttpMethod.Post, endpoint);
    request.Headers.Add("X-Requested-With", "local");
    switch (e.Request.RawUrl)
    {
        case "/on":
            request.Content = new StringContent("{\"format\":\"us\",\"freq\":38,\"data\":[3154,1646,346,441,342,1305,349,1286,349,441,350,424,349,439,342,441,347,423,349,1298,338,1296,347,423,356,423,351,441,345,1310,344,447,345,1315,347,444,347,445,346,445,347,445,349,1315,346,1317,350,1314,349,443,349,442,352,444,347,444,348,444,349,442,350,1314,350,1314,348,1316,347,8131,3177,1657,350,442,348,1316,349,1314,349,447,347,445,347,445,349,442,349,442,349,1319,344,1316,348,447,348,444,347,445,346,1317,347,446,349,1314,349,442,349,447,347,445,348,444,346,1317,347,1317,346,1318,349,445,346,448,345,446,344,448,346,446,346,445,346,1318,346,1318,346,1318,347,8133,3175,1659,345,448,346,1317,346,1318,346,446,346,445,349,447,344,451,341,448,344,1320,344,1315,349,447,347,445,346,446,346,1318,346,445,350,1314,349,443,348,448,344,447,348,444,346,1318,346,1318,348,1316,346,445,347,446,349,442,348,448,344,447,348,444,346,1318,346,1317,347,1317,346]}", System.Text.Encoding.UTF8, @"application/json");
            break;

        case "/off":
            request.Content = new StringContent("{\"format\":\"us\",\"freq\":38,\"data\":[3154,1646,346,441,342,1305,349,1286,349,441,350,424,349,439,342,441,347,423,349,1298,338,1296,347,423,356,423,351,441,345,1310,344,447,345,1315,347,444,347,445,346,445,347,445,349,1315,346,1317,350,1314,349,443,349,442,352,444,347,444,348,444,349,442,350,1314,350,1314,348,1316,347,8131,3177,1657,350,442,348,1316,349,1314,349,447,347,445,347,445,349,442,349,442,349,1319,344,1316,348,447,348,444,347,445,346,1317,347,446,349,1314,349,442,349,447,347,445,348,444,346,1317,347,1317,346,1318,349,445,346,448,345,446,344,448,346,446,346,445,346,1318,346,1318,346,1318,347,8133,3175,1659,345,448,346,1317,346,1318,346,446,346,445,349,447,344,451,341,448,344,1320,344,1315,349,447,347,445,346,446,346,1318,346,445,350,1314,349,443,348,448,344,447,348,444,346,1318,346,1318,348,1316,346,445,347,446,349,442,348,448,344,447,348,444,346,1318,346,1317,347,1317,346]}", System.Text.Encoding.UTF8, @"application/json");
            break;

        default:
            Console.WriteLine("Invalid Request");
            return;
    }

    await client.SendAsync(request);

    Console.WriteLine("Request Handled");
    e.Response.Close();
};

server.Start();

Console.WriteLine("Press Enter to exit.");
Console.ReadLine();